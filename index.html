<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>اختبار عارض PDF — Drive خارجي + Mozilla داخلي</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
<style>
:root{--bg:#0e1116;--card:#151b24;--b:#2b3342;--txt:#e8edf6;--mut:#a7b4c4;--pri:#4cc9f0}
*{box-sizing:border-box}html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--txt);font-family:"Cairo",system-ui,sans-serif}
.wrap{max-width:1100px;margin:0 auto;padding:12px}
.card{background:var(--card);border:1px solid var(--b);border-radius:12px;padding:12px}
.row{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
.input{flex:1;min-width:320px;padding:10px;border:1px solid var(--b);border-radius:10px;background:#10141c;color:var(--txt)}
.btn{padding:10px 12px;border-radius:10px;border:1px solid var(--b);background:#10141c;color:var(--txt);cursor:pointer}
.btn.primary{background:var(--pri);color:#001018;border-color:transparent}
.small{color:var(--mut);font-size:12px}
.viewer{height:78vh;border:1px solid var(--b);border-radius:12px;overflow:hidden;background:#0b0f16;margin-top:10px}
iframe{width:100%;height:100%;border:0;display:block}
.note{margin-top:8px;padding:8px;border:1px dashed var(--b);border-radius:10px;background:#10141c}
.err{position:sticky;top:0;background:#2b1111;color:#ffb2b2;padding:6px;display:none;z-index:999}
.badge{padding:3px 8px;border-radius:999px;border:1px solid var(--b);background:#10141c}
</style>
</head>
<body>
<div id="err" class="err"></div>

<div class="wrap">
  <div class="card">
    <b>اختبار عرض PDF</b>
    <div class="small">
      • روابط <span class="badge">Google Drive</span> تُفتح خارجيًا في المتصفّح لأن WebView الخاص بـ SPCK يمنع معاينتها داخل iframe.<br>
      • الروابط <span class="badge">المباشرة</span> تُعرض هنا عبر Mozilla PDF.js.
    </div>

    <!-- أزرار كتبك -->
    <div class="row" style="margin-top:8px">
      <button class="btn" data-demo="https://drive.google.com/file/d/1f62kK7mk4tD8Twefwmz4NhlnZlzaiOJ1/view?usp=drivesdk">كتاب 1 (Drive)</button>
      <button class="btn" data-demo="https://drive.google.com/file/d/147XMRq9zp7kDHCmIFqDIaWd0bEJ_nlRa/view?usp=drivesdk">كتاب 2 (Drive)</button>
      <button class="btn" data-demo="https://drive.google.com/file/d/1blO1gFn8YJdSj9M1wLL4Jne0ciDjb9K-/view?usp=drivesdk">كتاب 3 (Drive)</button>
      <button class="btn" data-demo="https://drive.google.com/file/d/1SyKIaepETaqS7CdapWn5pdUbyo8s4Ml1/view?usp=drivesdk">كتاب 4 (Drive)</button>
      <button class="btn" data-demo="https://drive.google.com/file/d/1Ry0lMuUkJ8UbqHs_MdDTzEAQ0VRLdVBU/view?usp=drivesdk">كتاب 5 (Drive)</button>
      <button class="btn" data-demo="https://drive.google.com/file/d/1MLC_EFceJtB5Xm8ZbJ-kF-SYcahOnVjP/view?usp=drivesdk">كتاب 6 (Drive)</button>
    </div>

    <!-- إدخال رابط يدوي -->
    <div class="row" style="margin-top:8px">
      <input id="pdfUrl" class="input" placeholder="ضع رابط PDF هنا (Drive أو مباشر)" value="https://mozilla.github.io/pdf.js/web/compressed.tracemonkey-pldi-09.pdf">
      <button id="openBtn" class="btn primary">فتح</button>
      <button id="forceDriveBtn" class="btn">فتح كـ Drive</button>
      <button id="forceMozBtn" class="btn">فتح كـ Mozilla</button>
    </div>

    <!-- العارض الداخلي (لمباشر فقط) -->
    <div class="viewer"><iframe id="frame" title="PDF"></iframe></div>
    <div id="note" class="note"></div>
  </div>
</div>

<script>
window.onerror=function(m,s,l,c){var b=document.getElementById('err');b.style.display='block';b.textContent='JS Error: '+m+' @'+l+':'+c};

function isDrive(u){return /drive\.google\.com/i.test(u)}
function driveId(u){var m=u.match(/\/d\/([\w-]+)\//);if(m)return m[1];m=u.match(/[?&]id=([\w-]+)/);if(m)return m[1];return null}
function drivePreview(u){var id=driveId(u);return id?('https://drive.google.com/file/d/'+id+'/preview'):u}
function mozURL(u){return 'https://mozilla.github.io/pdf.js/web/viewer.html?file='+encodeURIComponent(u)+'#zoom=page-fit'}

var frame=document.getElementById('frame'), note=document.getElementById('note'), inp=document.getElementById('pdfUrl');

/* فتح خارجي (يستخدم المتصفح الأصلي خارج SPCK) */
function openExternal(url){ try{ window.top.location.href=url; }catch(e){ window.location.href=url; } }

function openSmart(){
  var u=inp.value||''; if(!u){note.textContent='ضع رابط PDF أولًا.';return;}
  if(isDrive(u)){
    note.textContent='رابط Drive سيُفتح خارجيًا في المتصفّح (هذا هو الحل الذي يعمل على أندرويد داخل SPCK).';
    openExternal(drivePreview(u));
  }else{
    frame.src=mozURL(u);
    note.textContent='تم فتحه عبر Mozilla PDF.js داخل الصفحة.';
  }
}
function openDrive(){
  var u=inp.value||''; if(!u){note.textContent='ضع رابط PDF أولًا.';return;}
  note.textContent='فتح خارجي في Google Drive Preview…';
  openExternal(drivePreview(u));
}
function openMozilla(){
  var u=inp.value||''; if(!u){note.textContent='ضع رابط PDF أولًا.';return;}
  if(isDrive(u)){
    note.textContent='لا يمكن عرض Drive داخل Mozilla بسبب CORS — تم إلغاء العملية.';
    return;
  }
  frame.src=mozURL(u);
  note.textContent='تم فتحه عبر Mozilla PDF.js.';
}

/* أزرار */
document.getElementById('openBtn').onclick=openSmart;
document.getElementById('forceDriveBtn').onclick=openDrive;
document.getElementById('forceMozBtn').onclick=openMozilla;

/* أزرار الكتب */
var demos=document.querySelectorAll('[data-demo]');
for(var i=0;i<demos.length;i++){
  demos[i].onclick=function(){
    inp.value=this.getAttribute('data-demo');
    openSmart();
  };
}

/* افتح مثال مباشر افتراضيًا داخل العارض */
frame.src=mozURL(inp.value);
note.textContent='ملف مباشر عبر Mozilla PDF.js.';
</script>
</body>
</html>
